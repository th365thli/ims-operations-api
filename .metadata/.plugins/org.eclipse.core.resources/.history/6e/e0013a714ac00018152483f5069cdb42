/*********************************************************************************
 * Licensed Materials - Property of IBM
 * 5655-TAC
 * (C) Copyright IBM Corp. 2015 All Rights Reserved. 
 * US Government Users Restricted Rights - Use, duplication or
 * disclosure restricted by GSA ADP Schedule Contract with 
 * IBM Corp.               
 *********************************************************************************/
package com.ibm.ims.ea.om.rtc;

import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.util.Arrays;
import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;






import com.ibm.ims.ea.base.om.common.messages.IQEO;
import com.ibm.ims.ea.om.common.ImsResource;
import com.ibm.ims.ea.om.datastore.ImsTransactionTable;

/**
 * Class represents an object type of the return values for the RTC Query command.
 * All values that can be returned are mapped to this object, in the event a value 
 * is empty or not mapped the return value would be empty string.
 */
public class RoutingCode extends ImsResource {

	private static final Logger logger = LoggerFactory.getLogger(RoutingCode.class);

	/**
	 * Constructor helpful in creating an empty bean particularly in areas reflection is used. 
	 * Should be used with ({@link RoutingCode#setMap(Map)}
	 */
	public RoutingCode() {
		resourceType = ResourceType.RTC;
	}

	/**
	 * Method creates an instance of the bean given a Map representing the resource from an OM interaction
	 * @param omResourceResponse Map representation for IMS resource such as 
	 * a transaction or database query.
	 * @param properties
	 */
	public RoutingCode(Map<String, String> properties) {
		super(properties);
		resourceType = ResourceType.RTC;
	}

	public String getProperty(RtcResponseAttribute key){   //This will replace getInstanceField(....)
		return this.properties.get(key.toString());
	}

	/**
	 * Method creates an instance of the bean from an SQL ResultSet
	 * @param resultSet
	 * @throws SQLException
	 */
	public RoutingCode(ResultSet sqlResultSet) throws SQLException{
		//if (logger.isDebugEnabled()) { logger.debug(this.getClass() + "RoutingCode(ResultSet)"); }
		
		resourceType = ResourceType.RTC;
		ResultSetMetaData rsMetaData = sqlResultSet.getMetaData();
		int numberOfColumns = rsMetaData.getColumnCount();
		
		try {					
			for (int i = 1; i < numberOfColumns + 1; i++) {
			      String columnName = rsMetaData.getColumnName(i);
			      
			      if (columnName.equals(ImsTransactionTable.SYSPLEX_ID) ){
						properties.put(columnName, String.valueOf(sqlResultSet.getInt(columnName)));
					}else {
						if (sqlResultSet.getString(columnName) != null) {
							properties.put(columnName, sqlResultSet.getString(columnName));
						}
					}
			    }
		} catch(SQLException e) {
			if(logger.isDebugEnabled()){
				logger.debug(IQEO.IQEO0000E.msg(new Object[] {Arrays.toString(e.getStackTrace())}));
			}
		}
		
		//if (logger.isDebugEnabled()) { logger.debug(this.getClass() + "RoutingCode(ResultSet results): " + sqlResultSet.toString()); }
	}

	/**
	 * IMS Program Output fields that are returned for this resource type. 
	 * Depending on the command some fields when queried will return null.
	 */
	public enum RtcResponseAttribute {
		CC, CCTXT, DFNT, IMSID, INQ, LSTT, MBR, MDLN, MDLT, PGM, REG, REPO, RINQ, RPGM,
		RTC, RTMCR, RTMUP, TMAC, TMCR, TMIM, TMUP, WRK, ERRT,
		
		//NON-KEYWORDS
		SYSPLEX_ID, IMSPLX;

		public String value() {
			return name();
		}

		public static RtcResponseAttribute fromValue(String v) {
			return valueOf(v);
		}

		@Override
		public String toString(){
			return name();
		}

	}

	public enum STATUS {   

		/**active routing codes. */
		ACTIVE,
		/** Return information about routing codes that are not initialized and cannot be used. */
		NOTINIT,

		/** Return information about routing codes that are not scheduled. */
		NOTSCHD,

		/** Return information about routing codes that are stopped. */
		STOQ

	}


	@Override
	public void setMap(Map<String, String> resourceMap) {
		this.properties = resourceMap;
		this.resourceType = ResourceType.RTC;

	}

	@Override
	public void setAttribute(String key, String value) {
		this.properties.put(key, value);
	}
}
